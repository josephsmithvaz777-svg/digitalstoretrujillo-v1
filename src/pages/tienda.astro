---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import ProductCard from "../components/ProductCard.astro";
import { getAllProducts } from "../data/products";
import "../styles/global.css";

const products = getAllProducts();
---

<Layout title="Tienda - DigitalStore">
    <Header currentPath="/tienda" />

    <main class="flex-grow container mx-auto px-4 md:px-10 py-8 max-w-[1440px]">
        <!-- Filters Section -->
        <div
            class="sticky top-[72px] z-30 mb-8 -mx-4 px-4 md:mx-0 md:px-0 py-4 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-sm"
        >
            <div
                class="flex flex-col md:flex-row md:items-center justify-between gap-4"
            >
                <div
                    class="flex items-center gap-2 overflow-x-auto hide-scrollbar pb-2 md:pb-0"
                >
                    <button
                        class="flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap shadow-md shadow-primary/20"
                    >
                        <span class="material-symbols-outlined text-[18px]"
                            >apps</span
                        >
                        Todos los Productos
                    </button>
                    <button
                        class="flex items-center gap-2 bg-white dark:bg-[#283039] hover:bg-gray-50 dark:hover:bg-[#323b46] border border-gray-200 dark:border-[#3b4754] text-slate-700 dark:text-gray-200 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors"
                    >
                        <span class="material-symbols-outlined text-[18px]"
                            >movie</span
                        >
                        Streaming
                    </button>
                    <button
                        class="flex items-center gap-2 bg-white dark:bg-[#283039] hover:bg-gray-50 dark:hover:bg-[#323b46] border border-gray-200 dark:border-[#3b4754] text-slate-700 dark:text-gray-200 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors"
                    >
                        <span class="material-symbols-outlined text-[18px]"
                            >brush</span
                        >
                        Herramientas Creativas
                    </button>
                    <button
                        class="flex items-center gap-2 bg-white dark:bg-[#283039] hover:bg-gray-50 dark:hover:bg-[#323b46] border border-gray-200 dark:border-[#3b4754] text-slate-700 dark:text-gray-200 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors"
                    >
                        <span class="material-symbols-outlined text-[18px]"
                            >security</span
                        >
                        Seguridad
                    </button>
                    <button
                        class="flex items-center gap-2 bg-white dark:bg-[#283039] hover:bg-gray-50 dark:hover:bg-[#323b46] border border-gray-200 dark:border-[#3b4754] text-slate-700 dark:text-gray-200 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors"
                    >
                        <span class="material-symbols-outlined text-[18px]"
                            >computer</span
                        >
                        Software
                    </button>
                </div>

                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="relative group w-full md:w-auto">
                        <button
                            class="flex w-full md:w-auto items-center justify-between gap-3 bg-white dark:bg-[#283039] border border-gray-200 dark:border-[#3b4754] px-4 py-2 rounded-lg text-sm font-medium text-slate-700 dark:text-white"
                        >
                            <span>Ordenar por: Destacados</span>
                            <span class="material-symbols-outlined text-[20px]"
                                >keyboard_arrow_down</span
                            >
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Header -->
        <div class="flex items-end justify-between mb-6">
            <div>
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white">
                    Todas las Suscripciones
                </h1>
                <p class="text-slate-500 dark:text-gray-400 text-sm mt-2">
                    Mostrando {products.length} productos disponibles
                </p>
            </div>
        </div>

        <!-- Products Grid -->
        <div
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
        >
            {products.map((product) => <ProductCard {...product} />)}
        </div>

        <!-- Empty State (if no products) -->
        {
            products.length === 0 && (
                <div class="text-center py-16">
                    <span class="material-symbols-outlined text-6xl text-gray-300 dark:text-gray-600 mb-4">
                        inventory_2
                    </span>
                    <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2">
                        No hay productos disponibles
                    </h3>
                    <p class="text-slate-500 dark:text-gray-400">
                        Vuelve pronto para ver nuevas ofertas
                    </p>
                </div>
            )
        }
    </main>

    <Footer />
</Layout>

<script>
    // Filter and search functionality
    document.addEventListener("DOMContentLoaded", () => {
        const filterButtons = document.querySelectorAll(
            ".flex.items-center.gap-2",
        );
        const productCards = document.querySelectorAll("[data-category]");
        const productCountElement = document.querySelector(
            ".text-slate-500.dark\\:text-gray-400.text-sm.mt-2",
        );

        // Category filter functionality
        filterButtons.forEach((button, index) => {
            button.addEventListener("click", () => {
                // Remove active class from all buttons
                filterButtons.forEach((btn) => {
                    btn.classList.remove(
                        "bg-primary",
                        "text-white",
                        "shadow-md",
                        "shadow-primary/20",
                    );
                    btn.classList.add(
                        "bg-white",
                        "dark:bg-[#283039]",
                        "text-slate-700",
                        "dark:text-gray-200",
                    );
                });

                // Add active class to clicked button
                button.classList.add(
                    "bg-primary",
                    "text-white",
                    "shadow-md",
                    "shadow-primary/20",
                );
                button.classList.remove(
                    "bg-white",
                    "dark:bg-[#283039]",
                    "text-slate-700",
                    "dark:text-gray-200",
                );

                // Filter products
                const categories = [
                    "all",
                    "streaming",
                    "creative",
                    "security",
                    "software",
                ];
                const selectedCategory = categories[index];

                let visibleCount = 0;
                productCards.forEach((card) => {
                    const cardCategory = (card as HTMLElement).dataset.category;
                    if (
                        selectedCategory === "all" ||
                        cardCategory === selectedCategory
                    ) {
                        (card as HTMLElement).style.display = "block";
                        visibleCount++;
                    } else {
                        (card as HTMLElement).style.display = "none";
                    }
                });

                // Update product count
                if (productCountElement) {
                    productCountElement.textContent = `Mostrando ${visibleCount} productos disponibles`;
                }
            });
        });
    });
</script>
